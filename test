#!/bin/bash

# Get all SCCs
echo "Getting all SCCs..."
oc get scc

# Describe all roles in all namespaces
echo "Describing all roles in all namespaces..."
oc describe roles --all-namespaces

# Describe all cluster roles
echo "Describing all cluster roles..."
oc describe clusterroles

# Define the regex for SCCs to exclude
SCCS_TO_EXCLUDE_REGEX="^privileged$|^hostnetwork-v2$|^restricted-v2$|^nonroot-v2$"

# Get unqualified SCCs
echo "Getting unqualified SCCs..."
oc get scc -o json | jq -r ".items[] | select(.metadata.name | test(\"$SCCS_TO_EXCLUDE_REGEX\"; \"\") | not) | select(.allowedCapabilities != null) | .metadata.name"
